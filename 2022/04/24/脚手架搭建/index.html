<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="heywc">
    
    <title>
        
            脚手架搭建 |
        
        heywc
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/head.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                heywc
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">脚手架搭建</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/head.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">heywc</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-04-24 00:23:34</span>
        <span class="mobile">2022-04-24 00:23</span>
    </span>
    
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="为啥会想到自己搭建一个项目脚手架"><a href="#为啥会想到自己搭建一个项目脚手架" class="headerlink" title="为啥会想到自己搭建一个项目脚手架"></a>为啥会想到自己搭建一个项目脚手架</h2><p>我举个身边的例子：</p>
<ol>
<li>同事甲在搭建新项目的时候，直接 pull 了他在远程仓库预先配置好的项目模板</li>
<li>同事乙经验老道，直接将之前写的项目拷贝了一份，删除了一些无用的代码，那么也是搭建起了新的项目</li>
<li>同事丙前端新手玩家，选择了 vue-cli 然后一步步开始下载插件，增写配置</li>
</ol>
<p>相对而言，甲的方式更加节省时间，但是如果新项目和远程仓库的项目存在一些差异，他依旧需要手动去修改这些差异；乙的方式，虽然也不慢，但是会导致新项目中残留老项目的残留代码（要知道新时代怎么会存在承载旧时代残党的船呢–致敬-白胡子）；但是丙的搭建项目方式可想而知，非常费时间。</p>
<p>因此我就在想有没有一种技术方案能同时解决上述问题，既操作简单又节省时间，还能使新搭建的项目更加规范。这不就是所谓的给团队增效的方案嘛。一想到这，我觉得我他娘是个天才（O(∩_∩)O 手动狗头）</p>
<p>为此我命名它为<code>ywc-cli</code> 脚手架方案。没错，就是以我名字缩写加上 cli 组合而成的！设计的思路有以下两种：</p>
<p><code>最简易版本</code>: 可选地拉取远程仓库预设好的模板，只需要安装完 ywc-cli，运行 cmd 脚本指令 <code>ywc-cli create xxx</code>就可以直接选择需要安装的项目模板了，而我目前是简单提供了 vue2 和 vue3 的初始化模板，后续会对这两个模板进行完善，当然我也希望增加 react 的项目模板。</p>
<p>由于留给我的时间不多了，所以我只实现了这个版本的代码。</p>
<p>吹一波好处：这种应该是最常见且最简单层面的脚手架，只需要在远程仓库中存有不用版本的项目模板，开发人员安装完脚手架之后可根据项目自行选择安装的版本，快速搭建起项目。这种脚手架适用于公司专门定制化项目，例如专门定制商城项目或者数据展示项目以及是内网的后台系统，这类项目的特点就是在确保 UI 组件大致不变的情况下，不同项目之间代码复用率极高。因此公司的定制化项目应该有其对应的脚手架，这样便能大幅度缩短项目的开发周期并且规范代码</p>
<p><code>自定义版本</code>：可执行性待验证</p>
<ol>
<li><p> 脚手架中预设好了项目模板，执行 create 指令时首先进行模板类型选择，将拷贝模板至临时目录，这步通常是选择技术框架；</p>
</li>
<li><p> 根据开发人员的选择去安装对应的插件,这一步需要准备一个映射文件存储技术框架与对应的插件之间的映射关系，同时还得准备插件对应的配置代码。根据选中的插件，通过模板引擎渲染，临时目录中的模板</p>
</li>
<li><p> 生成临时目录中的项目模板</p>
</li>
</ol>
<p>这个最定义版本的核心思想就是<code>通过模板引擎渲染对应插件的配置代码</code>,实现起来也是不难的，不过如果能将这个过程的核心通过一个工具类来实现，那才是技术难点。</p>
<p>技术方案想法简单介绍完了，下面就该介绍技术实现了，相关工具必须先安排上，当然这个脚手架是基于 node.js 实现的。</p>
<h2 id="脚手架相关工具"><a href="#脚手架相关工具" class="headerlink" title="脚手架相关工具"></a>脚手架相关工具</h2><hr>
<ol>
<li><strong>inquirer.js</strong></li>
</ol>
<p>为 node.js 提供了易于嵌入且美观的命令行接口。通俗点解释就是询问工具，我们可以通过该工具设置脚手架需要向用户询问的一些问题，比如是否安装 xxx 工具、该项目版本号等等</p>
<p><code>安装</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">npm install inquirer<br></code></pre></td></tr></table></figure>

<p><code>用法:</code><br>调用 inquirer.prompt 方法，prompt 接收两个参数：一个是 qustionArray(数组)，用来设置需要询问的问题；另一个是 answer（对象），默认为{},如果设置了某个问题的答案，该问题将被跳过。执行结果是个 promise 对象。问题的类型有很多种，在此我只是展示了常见的 input。</p>
<p>在 cli.js 文件中添加以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">var</span> <span class="hljs-variable">inquirer</span> <span class="hljs-operator">=</span> require(<span class="hljs-string">&#x27;inquirer&#x27;</span>);<br>inquirer.prompt([<br>    <span class="hljs-comment">/* 设置问题 */</span><br>    &#123;<br>        type: <span class="hljs-string">&#x27;input&#x27;</span>,<br>        name: <span class="hljs-string">&#x27;author&#x27;</span>,<br>        message: <span class="hljs-string">&#x27;author&#x27;</span>,<br>        <span class="hljs-keyword">default</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    &#125;,<br>    &#123;<br>        type: <span class="hljs-string">&#x27;input&#x27;</span>,<br>        name: <span class="hljs-string">&#x27;version&#x27;</span>,<br>        message: <span class="hljs-string">&#x27;version&#x27;</span>,<br>    &#125;<br>],&#123;version: <span class="hljs-string">&#x27;1.0.1&#x27;</span>&#125;)<br>.then((answers) =&gt; &#123;<br>  <span class="hljs-comment">// 完成询问，执行回调，在此可对询问结果做一些保存等的操作</span><br>  console.log(answers);<br>&#125;)<br>.<span class="hljs-keyword">catch</span>((error) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (error.isTtyError) &#123;<br>      <span class="hljs-comment">//在当前环境中无法呈现</span><br>        console.log(<span class="hljs-string">&#x27;在当前环境中无法呈现&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 其他错误</span><br>        console.log(<span class="hljs-string">&#x27;其他报错&#x27;</span>,error);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>当设置问题类型为 input 时，遇到个很有意思的现象，就是不管我们输入的是什么类型的数据，node 环境中接收到的始终是<code>字符串类型</code>。因此要对数字进行校验时，不可直接使用 typeof 来判断数字类型，应该用 parseFloat、parseInt 或者正则。</p>
<p><code>测试执行结果</code></p>
<p><img src="https://files.mdnice.com/user/8429/08037beb-bd87-4a51-9547-512b7a89f7d4.png"></p>
<ol start="2">
<li><strong>commander</strong></li>
</ol>
<p>指令工具，我们可以配置<code>create</code>等等操作指令</p>
<p><code>安装</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">npm install commander<br></code></pre></td></tr></table></figure>

<p><code>用法</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">program<br>  .command(&#x27;clone &lt;source&gt; [destination]&#x27;)<br>  .description(&#x27;clone a repository into a newly created directory&#x27;)<br>  .action((source, destination) =&gt; &#123;<br>    console.log(&#x27;clone command called&#x27;);<br>  &#125;);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><strong>handlebars、ejs</strong></li>
</ol>
<p>模板替换工具(预编译工具)</p>
<p>模板工具有很多种根据自己的想法选择合适的即可。</p>
<ol start="4">
<li><strong>axios</strong></li>
</ol>
<p>异步请求工具</p>
<p>这个不必过多解释,vue 中常用。我们要想下载远程仓库中模板文件，必然是需要先请求地址的，去获取远程的模板信息（模板文件名/模板版本信息等），之后我们进行选择之后，方可下载文件</p>
<ol start="5">
<li><strong>download-git-repo</strong></li>
</ol>
<p>下载远程文件工具</p>
<p>利用该工具，我们便可以根据 git 地址下载我们所需要的的初始化模板文件。</p>
<ol start="6">
<li><strong>ora</strong></li>
</ol>
<p>下载提示工具</p>
<p><code>安装</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">npm install ora<br></code></pre></td></tr></table></figure>

<p><code>使用</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> ora <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ora&quot;</span>;<br><span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>(<span class="hljs-string">&quot;fetch template......&quot;</span>);<br><br>spinner.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 开始加载loading</span><br><br>spinner.<span class="hljs-title function_">succeed</span>(); <span class="hljs-comment">// 结束加载loading</span><br></code></pre></td></tr></table></figure>

<p>在使用的时候，遇到了这么个问题如下：</p>
<p><img src="https://files.mdnice.com/user/8429/91872e7d-219d-47cb-8266-8584a9ab04af.png"></p>
<p>其实就是 node.js 在引入 es6 模块时与其 common.js 规范冲突。所以只需解决这个问题，就自然而然解决上了上面的问题了。</p>
<p><em>我们可以检测下当前的 node 环境对 es6 的支持情况：</em></p>
<p>安装 es-checker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">npm -g install es-checker<br></code></pre></td></tr></table></figure>

<p>在执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">es-checker<br></code></pre></td></tr></table></figure>

<p>可以看到以下结果，虽然对 ES6 的支持度很高，但是对 ES6 的模块显示是不支持的。</p>
<p><img src="https://files.mdnice.com/user/8429/80ab511d-0659-49b9-9941-c62669a57bd1.png"></p>
<p>解法一：</p>
<p>增设 package.json 中的信息：<br>type：“module”。我试了下，并没有解决问题。</p>
<p>解法二:</p>
<p>降低 ora 的版本，安装<a class="link"   href="mailto:&#x6f;&#x72;&#97;&#x40;&#52;&#x2e;&#x30;&#x2e;&#x34;" >&#x6f;&#x72;&#97;&#x40;&#52;&#x2e;&#x30;&#x2e;&#x34;<i class="fas fa-external-link-alt"></i></a>版本。这个办法应该是最简单粗暴的了。既然最新的版本是以 ES6 的模块的形式导出，那么我们将版本降至符合 common.js 规范的版本即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npm install ora@<span class="hljs-number">4.0</span><span class="hljs-number">.4</span><br></code></pre></td></tr></table></figure>

<p>与此同时，我们将修改 ora 的引入方式。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">- import ora from &#x27;ora&#x27;;</span><br><span class="hljs-addition">+ const ora = require(&#x27;ora&#x27;)</span><br><br></code></pre></td></tr></table></figure>

<p>解法三：</p>
<p>配置<em>babel</em>,众所周知 babel 是是一个 JavaScript 编译器，主要用于将采用 ECMAScript 2015+ 语法编写的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。</p>
<p>配置不恰当 不生效 待完善!</p>
<p>这块我真的挺苦恼的，尝试了很久还是没有很好的处理，同时也没有大牛指导</p>
<h2 id="脚手架搭建流程"><a href="#脚手架搭建流程" class="headerlink" title="脚手架搭建流程"></a>脚手架搭建流程</h2><p>可将脚手架搭建分成 3 种流程。</p>
<h3 id="第一种："><a href="#第一种：" class="headerlink" title="第一种："></a>第一种：</h3><p><code>1. 初始化脚手架</code><br><br><code>2. 设置操作指令</code><br><br>安装项目指令等等<br><br><code>3. 拉取远程仓库中的项目模板</code><br><br>便于及时更新，同时可以使得项目更加工程化、标准化。<br>针对不同类型的项目设置不同的模板，例如移动端 H5 项目及 PC 端项目；又或者是针对不同前端框架的模板，例如针对 react 或者 vue <br><br><code>4. 发布至npm</code><br><br>安装发布了的脚手架可以快速搭建项目，大大减少项目搭建的时间。</p>
<h3 id="第二种："><a href="#第二种：" class="headerlink" title="第二种："></a>第二种：</h3><p><code>1. 初始化脚手架</code><br><br><code>2. 设置操作指令</code><br><br><code>3. 根据用户的输入，配置初始化信息</code><br><br>设置项目的个性化信息。比如项目名称,创建者等<br><br><code>4. 根据用户的选择，配置功能插件</code><br><br>根据项目的大小以及类型。搭配对应的功能插件<br><br><code>5. * 拓展脚手架的功能</code><br><br>实现前端自动化测试等功能<br><br><code>6. 发布至npm</code><br></p>
<h3 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h3><p><code>1. 初始化脚手架</code> <br><br><code>2. 设置操作指令</code><br><br><code>3. 拉取远程仓库中的项目模板</code><br><br><code>4. 根据用户的输入，配置初始化信息</code><br><br><code>5. 根据用户的选择，配置功能插件</code><br><br><code>6. * 拓展脚手架的功能</code><br><br><code>7. 发布至npm</code></p>
<h2 id="具体实现及代码展示"><a href="#具体实现及代码展示" class="headerlink" title="具体实现及代码展示"></a>具体实现及代码展示</h2><h3 id="1-初始化脚手架"><a href="#1-初始化脚手架" class="headerlink" title="1.初始化脚手架"></a>1.初始化脚手架</h3><ol>
<li>创建工程文件夹 yu-cli。执行 npm init，创建 package.json 文件。</li>
<li>创建入口文件 cli.js。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">type nul&gt;cli.js<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>修改 package.json。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;ywc-cli&quot;</span>, <span class="hljs-comment">// 自定义</span><br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;cli.js&quot;</span>,<br>+  <span class="hljs-string">&quot;bin&quot;</span>: <span class="hljs-string">&quot;cli.js&quot;</span>,<span class="hljs-comment">// 入口文件</span><br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;ywc&quot;</span>,<span class="hljs-comment">// 自定义</span><br>  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>测试初始化脚手架能否运行。</li>
</ol>
<p>给 cli.js 添加测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">#!/usr/bin/env node  <span class="hljs-comment">// 这行必须得加，否则以下执行会报错。作用：当系统运行到这一行的时候，去 env 中查找 node 配置，并且调用对应的解释器来运行之后的 node 程序</span><br><br>console.log(<span class="hljs-string">&#x27;my cli is working!!!&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>执行 npm link。正确操作的情况下，我们在控制台执行<code> yu-cli</code>,可看到打印信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">my cli is working!!!<br></code></pre></td></tr></table></figure>

<p>如果没加这行代码<code> #!/usr/bin/env node</code> 而导致报错，可在添加后 执行 npm link –force 强制覆盖。</p>
<h3 id="2-设置指令"><a href="#2-设置指令" class="headerlink" title="2.设置指令"></a>2.设置指令</h3><p>配置指令信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mapActions = &#123;<br>  <span class="hljs-attr">create</span>: &#123;<br>    <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;c&quot;</span>,<br>    <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;create a project&quot;</span>,<br>    <span class="hljs-attr">examples</span>: [<span class="hljs-string">&quot;ywc-cli create &lt;project-name&gt;&quot;</span>],<br>  &#125;,<br>  <span class="hljs-string">&quot;*&quot;</span>: &#123;<br>    <span class="hljs-attr">alias</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;command not found&quot;</span>,<br>    <span class="hljs-attr">examples</span>: [],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>如果执行的指令就提示 command not found，反之执行对应的指令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(mapActions).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> &#123;<br>  program<br>    .<span class="hljs-title function_">command</span>(action) <span class="hljs-comment">// 配置指令名字</span><br>    .<span class="hljs-title function_">alias</span>(mapActions[action].<span class="hljs-property">alias</span>) <span class="hljs-comment">// 指令别名</span><br>    .<span class="hljs-title function_">description</span>(mapActions[action].<span class="hljs-property">description</span>) <span class="hljs-comment">// 指令描述</span><br>    .<span class="hljs-title function_">action</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (action === <span class="hljs-string">&quot;*&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapActions[action].<span class="hljs-property">description</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ywc-cli create xxx  [node, ywc-cli, create, xxx]</span><br>        <span class="hljs-built_in">require</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;lib&quot;</span>, action))(<br>          ...process.<span class="hljs-property">argv</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>)<br>        );<br>      &#125;<br>    &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="3-设置可选模板"><a href="#3-设置可选模板" class="headerlink" title="3.设置可选模板"></a>3.设置可选模板</h3><p>这里我是知道自己在远程配置了两种模板<code>vue2template</code>, <code>vue3template</code>,所以可以静态地配置，只不过这样每次新增模板需要更改源码。当然也可以通过 github 的 api 通过异步请求的方式获取模板类型，动态获取。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 预设 模板名</span><br><span class="hljs-keyword">let</span> tags = [<span class="hljs-string">&quot;vue2template&quot;</span>, <span class="hljs-string">&quot;vue3template&quot;</span>];<br><span class="hljs-keyword">const</span> &#123; tag &#125; = <span class="hljs-keyword">await</span> inquirer.<span class="hljs-title function_">prompt</span>([<br>  <span class="hljs-comment">/* 设置问题 */</span> &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;list&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tag&quot;</span>,<br>    <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;please choose a template to create project&quot;</span>,<br>    <span class="hljs-attr">choices</span>: tags,<br>  &#125;,<br>]);<br></code></pre></td></tr></table></figure>

<h3 id="4-下载模板"><a href="#4-下载模板" class="headerlink" title="4.下载模板"></a>4.下载模板</h3><p>通过上一步选择的模板名，我们便可以通过<code>download-git-repo</code>来下载远程仓库中的项目模板。在此之前先封装下 loading</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ora = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ora&quot;</span>);<br><br><span class="hljs-comment">// 封装loading</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">waitFnLoading</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">fn, message, ...args</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> spinner = <span class="hljs-title function_">ora</span>(message);<br>  spinner.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 开始加载loading</span><br>  <span class="hljs-keyword">let</span> repos = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(...args);<br>  spinner.<span class="hljs-title function_">succeed</span>(<span class="hljs-string">&quot;succeed ！&quot;</span>); <span class="hljs-comment">// 结束加载loading</span><br>  <span class="hljs-keyword">return</span> repos;<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">waitFnLoading</span>: waitFnLoading,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>下载并生成文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 从远程仓库下载模板</span><br><span class="hljs-comment">// tag: 模板名; proName:项目名; sign:是否作为临时文件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">downloadTemplate</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">tag, proName, sign</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> api = <span class="hljs-string">`1842347744/<span class="hljs-subst">$&#123;tag&#125;</span>`</span>;<br>  <span class="hljs-keyword">let</span> pro = sign ? <span class="hljs-string">`<span class="hljs-subst">$&#123;downloadDirectory&#125;</span>/<span class="hljs-subst">$&#123;tag&#125;</span>`</span> : proName;<br>  <span class="hljs-keyword">let</span> repo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">downLoadGitRepo</span>(api, pro);<br>  <span class="hljs-comment">// 后续版本会使用</span><br>  <span class="hljs-keyword">return</span> repo;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="关于下个版本"><a href="#关于下个版本" class="headerlink" title="关于下个版本"></a>关于下个版本</h2><p>新增功能就是根据用户选择安装对应插件</p>
<p><code>安装配置vuex为例：</code></p>
<p>在脚手架中配置 vuex 相关的的初始化模板文件，待用户确定安装 vuex 后，将其写入待生成的项目中。</p>
<ol>
<li>配置 vuex.js 模板</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-attr">state</span>: &#123;&#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;&#125;,<br>  <span class="hljs-attr">actions</span>: &#123;&#125;,<br>  <span class="hljs-attr">modules</span>: &#123;&#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>配置问题项及生成 vuex 关键代码：</li>
</ol>
<p>这里默认 true 即同意使用 vuex,通过 fs.readFileSync 读取 temp/vuex.js 模板文件，使用 fs.writeFile 写入项目中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js">inquirer<br>  .<span class="hljs-title function_">prompt</span>([<br>    &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;confirm&quot;</span>,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;vuex&quot;</span>,<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;是否使用vuex&quot;</span>,<br>      <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br>  ])<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">answer</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (answer.<span class="hljs-property">vuex</span>) &#123;<br>      <span class="hljs-comment">// 读取模板</span><br>      <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;temp/vuex.js&quot;</span>));<br>      <span class="hljs-comment">// 创建store文件夹</span><br>      fs.<span class="hljs-title function_">mkdirSync</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../test/src/store&quot;</span>));<br>      <span class="hljs-comment">// 根据模板文件创建index.js</span><br>      fs.<span class="hljs-title function_">writeFile</span>(<br>        path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../test/src/store/index.js&quot;</span>),<br>        data,<br>        <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (err) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;失败&quot;</span>);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;成功&quot;</span>);<br>          &#125;<br>        &#125;<br>      );<br>    &#125;<br>  &#125;);<br></code></pre></td></tr></table></figure>

<p>这里我只是简单展示通过 fs 的读写进行配置插件，当然也可以使用模板引擎进行渲染。</p>
<hr>

<p>写到这，代表文章要收尾了。目前只能说最简易版的一代<code>ywc-cli</code>告一段落，等新东家找到后，我会继续更新版本…</p>
<p>安装包已经发布到 npm 上了，可以直接安装使用，同时源码也分享到了 github 源码很简单，感兴趣的小伙伴可以拉下来看看，，愿共勉！^_^</p>
<p><img src="https://img.soogif.com/5HkHKKxGJ6ZmhQ7c8nLYOE9jfEXDpqp4.gif?scope=mdnice"></p>

        </div>

        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/04/24/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%BC%E5%87%BAexcel%E7%9A%84%E7%A5%9E%E5%A5%87%E4%B9%8B%E6%97%85/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">移动端浏览器导出excel的神奇之旅</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/04/24/%E7%BB%84%E4%BB%B6%E5%BA%93%E6%90%AD%E5%BB%BA/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">组件库搭建</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">heywc</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>








<div class="post-scripts">
    
</div>



</body>
</html>
